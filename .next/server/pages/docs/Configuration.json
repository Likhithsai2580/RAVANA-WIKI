{"pageProps":{"doc":{"slug":"Configuration","title":"Configuration","content":"<h1>Configuration</h1>\n<h2>Update Summary</h2>\n<p><strong>Changes Made</strong></p>\n<ul>\n<li>Added comprehensive documentation for enhanced graceful shutdown configuration options</li>\n<li>Updated LLM provider configuration section with new Gemini API key details</li>\n<li>Added new section on shutdown coordinator functionality and phases</li>\n<li>Updated environment variables section with new shutdown-related settings</li>\n<li>Added new diagram for shutdown process flow</li>\n<li>Updated referenced files list with new and modified files</li>\n</ul>\n<h2>Table of Contents</h2>\n<ol>\n<li><a href=\"#configuration-overview\">Configuration Overview</a></li>\n<li><a href=\"#core-configuration-files\">Core Configuration Files</a></li>\n<li><a href=\"#config-class-implementation\">Config Class Implementation</a></li>\n<li><a href=\"#llm-provider-configuration\">LLM Provider Configuration</a></li>\n<li><a href=\"#module-specific-settings\">Module-Specific Settings</a></li>\n<li><a href=\"#configuration-loading-and-validation\">Configuration Loading and Validation</a></li>\n<li><a href=\"#environment-variables-and-overrides\">Environment Variables and Overrides</a></li>\n<li><a href=\"#sensitive-data-handling\">Sensitive Data Handling</a></li>\n<li><a href=\"#advanced-configuration-management\">Advanced Configuration Management</a></li>\n<li><a href=\"#configuration-examples\">Configuration Examples</a></li>\n<li><a href=\"#common-configuration-issues\">Common Configuration Issues</a></li>\n<li><a href=\"#best-practices\">Best Practices</a></li>\n</ol>\n<h2>Configuration Overview</h2>\n<p>The RAVANA system implements a comprehensive configuration management system that combines JSON configuration files with environment variable overrides. The system supports multiple configuration sources, including global settings, module-specific configurations, and runtime environment variables. This layered approach enables flexible deployment across different environments while maintaining security and consistency.</p>\n<p>The configuration system serves as the central nervous system for the AGI framework, controlling everything from LLM provider selection to emotional intelligence parameters and autonomous behavior patterns. Two primary mechanisms work together: the static <code>config.json</code> files that define default settings and provider configurations, and the dynamic <code>Config</code> class that loads, validates, and provides access to settings throughout the application.</p>\n<p><strong>Section sources</strong></p>\n<ul>\n<li><a>config.py</a></li>\n<li><a>config.json</a></li>\n</ul>\n<h2>Core Configuration Files</h2>\n<p>The system utilizes multiple JSON configuration files to manage different aspects of the AGI framework. The primary configuration file <code>core/config.json</code> contains LLM provider credentials, API endpoints, and model availability information. This file serves as the authoritative source for external service integrations.</p>\n<p>``mermaid\ngraph TD\nA[Configuration Files] --> B[core/config.json]\nA --> C[modules/conversational_ai/config.json]\nA --> D[modules/emotional_intellegence/config.json]\nA --> E[modules/emotional_intellegence/persona.json]\nB --> F[LLM Providers]\nB --> G[API Keys]\nB --> H[Model Lists]\nC --> I[Platform Integration]\nC --> J[Communication Settings]\nD --> K[Emotional Triggers]\nD --> L[Behavior Influences]\nE --> M[Persona Definitions]\nE --> N[Mood Multipliers]</p>\n<pre><code>\n**Diagram sources**\n- [config.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\config.json#L1-L193)\n- [conversational_ai/config.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\modules\\conversational_ai\\config.json#L1-L27)\n- [emotional_intellegence/config.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\modules\\emotional_intellegence\\config.json#L1-L202)\n- [persona.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\modules\\emotional_intellegence\\persona.json#L1-L86)\n\n**Section sources**\n- [config.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\config.json#L1-L193)\n- [conversational_ai/config.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\modules\\conversational_ai\\config.json#L1-L27)\n- [emotional_intellegence/config.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\modules\\emotional_intellegence\\config.json#L1-L202)\n- [persona.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\modules\\emotional_intellegence\\persona.json#L1-L86)\n\n## Config Class Implementation\n\nThe `Config` class in `core/config.py` serves as the central configuration manager, providing a unified interface for accessing settings from both JSON files and environment variables. This class implements a hierarchical override system where environment variables take precedence over JSON file values, enabling flexible deployment configurations.\n\n```python\nclass Config:\n    DATABASE_URL = os.environ.get(\"DATABASE_URL\", \"sqlite:///ravana_agi.db\")\n    LOG_LEVEL = os.environ.get(\"LOG_LEVEL\", \"INFO\")\n    CURIOSITY_CHANCE = float(os.environ.get(\"CURIOSITY_CHANCE\", 0.3))\n    # ... additional settings\n</code></pre>\n<p>The class uses Python's <code>os.environ.get()</code> method to retrieve environment variables with fallback to default values. Type conversion is explicitly handled for different data types: strings remain as-is, numeric values are converted using <code>int()</code> or <code>float()</code>, and boolean values are parsed from string representations (\"true\", \"1\", \"yes\") to Python boolean values.</p>\n<p>``mermaid\nclassDiagram\nclass Config {\n+DATABASE_URL : str\n+LOG_LEVEL : str\n+CURIOSITY_CHANCE : float\n+REFLECTION_CHANCE : float\n+LOOP_SLEEP_DURATION : int\n+EMOTIONAL_PERSONA : str\n+SNAKE_AGENT_ENABLED : bool\n+BLOG_ENABLED : bool\n+get_setting(key : str) : Any\n+validate_configuration() : List[str]\n}\nclass ConfigLoader {\n+load_from_json(path : str) : Dict\n+load_from_env(prefix : str) : Dict\n+merge_configurations() : Dict\n+validate_settings(config : Dict) : bool\n}\nConfig \"1\" -- \"1\" ConfigLoader : uses</p>\n<pre><code>\n**Diagram sources**\n- [config.py](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\config.py#L2-L182)\n\n**Section sources**\n- [config.py](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\config.py#L2-L182)\n\n## LLM Provider Configuration\n\nThe system supports multiple LLM providers through the `core/config.json` file, which defines API endpoints, authentication credentials, and available models for each provider. This configuration enables the system to route requests to different providers based on model availability, cost considerations, and performance requirements.\n\n### Provider Configuration Structure\n\nEach provider in the configuration file follows a consistent structure with the following key components:\n\n- **api_key**: Authentication token for the provider API\n- **base_url**: Endpoint URL for API requests\n- **models**: List of available models that can be used\n\n```json\n{\n  \"zuki\": {\n    \"api_key\": \"zu-ab9fba2aeef85c7ecb217b00ce7ca1fe\",\n    \"base_url\": \"https://api.zukijourney.com/v1\",\n    \"models\": [\n      \"gpt-4o:online\",\n      \"gpt-4o\",\n      \"deepseek-chat\",\n      \"deepseek-reasoner\"\n    ]\n  }\n}\n</code></pre>\n<h3>Multi-Key Fallback System</h3>\n<p>The Gemini provider implements a sophisticated multi-key fallback system that allows the system to rotate through multiple API keys when rate limits are reached:</p>\n<pre><code class=\"language-json\">\"gemini\": {\n  \"api_keys\": [\n    {\n      \"id\": \"gemini_key_1\",\n      \"key\": \"AIzaSyBW-aVU-x7JCjBJVVKjPGUacups0-GBHvQ\",\n      \"priority\": 1,\n      \"failure_count\": 0,\n      \"last_success\": null\n    },\n    {\n      \"id\": \"gemini_key_2\",\n      \"key\": \"AIzaSyBW-aVU-x7JCjBJVVKjPGUacups0-GBHvQ\",\n      \"priority\": 2,\n      \"failure_count\": 0,\n      \"last_success\": null\n    },\n    {\n      \"id\": \"gemini_key_3\",\n      \"key\": \"AIzaSyC8hTaXE6jkWDFZyZDybFEoHfPR-4VSV-k\",\n      \"priority\": 3,\n      \"failure_count\": 0,\n      \"last_success\": null\n    },\n    {\n      \"id\": \"gemini_key_10\",\n      \"key\": \"AIzaSyBCQic67-TJmSXUVTCiW3SFU5fLZx7enII\",\n      \"priority\": 10,\n      \"failure_count\": 0,\n      \"last_success\": null\n    }\n  ],\n  \"rate_limit\": {\n    \"requests_per_minute\": 60,\n    \"cooldown_period\": 300,\n    \"max_retries\": 3,\n    \"backoff_factor\": 2.0\n  },\n  \"fallback\": {\n    \"enabled\": true,\n    \"timeout\": 30,\n    \"max_key_failures\": 5\n  }\n}\n</code></pre>\n<p>This configuration enables resilient operation by automatically switching to backup keys when the primary key encounters rate limiting or failures. The recent update has expanded the Gemini configuration to include 10 API keys with priority-based rotation.</p>\n<p>``mermaid\nsequenceDiagram\nparticipant Client as \"Application\"\nparticipant Config as \"Config System\"\nparticipant Provider as \"LLM Provider\"\nClient->>Config : Request model usage\nConfig->>Config : Select provider based on model availability\nConfig->>Provider : Send API request with primary key\nalt Rate limit exceeded\nProvider-->>Config : 429 Too Many Requests\nConfig->>Config : Increment failure count\nConfig->>Config : Select next priority key\nConfig->>Provider : Retry with backup key\nelse Success\nProvider-->>Config : 200 OK with response\nend\nConfig-->>Client : Return response or error</p>\n<pre><code>\n**Diagram sources**\n- [config.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\config.json#L1-L193)\n- [llm.py](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\llm.py#L46-L114)\n\n**Section sources**\n- [config.json](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\config.json#L1-L193)\n- [llm.py](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\llm.py#L46-L114)\n\n## Module-Specific Settings\n\nDifferent modules within the RAVANA system have specialized configuration requirements that are managed through dedicated configuration files and settings.\n\n### Emotional Intelligence Configuration\n\nThe emotional intelligence module uses two configuration files to define emotional states and persona behaviors:\n\n```json\n{\n  \"emotional_intelligence_config\": {\n    \"primary_emotions\": {\n      \"joy_based\": [\"Confident\", \"Excited\", \"Inspired\", \"Satisfied\"],\n      \"interest_based\": [\"Curious\", \"Reflective\", \"Intrigued\", \"Engaged\"]\n    },\n    \"secondary_emotions\": [\n      \"Hopeful\", \"Grateful\", \"Proud\", \"Guilty\"\n    ],\n    \"emotion_intensity_levels\": {\n      \"low\": [0.0, 0.33],\n      \"medium\": [0.34, 0.66],\n      \"high\": [0.67, 1.0]\n    },\n    \"triggers\": {\n      \"new_discovery\": \"The agent has discovered new information or learned something novel.\",\n      \"task_completed\": \"A task or goal has been successfully completed.\"\n    },\n    \"mood_updates\": {\n      \"new_discovery\": {\n        \"Curious\": 0.2,\n        \"Excited\": 0.15,\n        \"Inspired\": 0.1\n      }\n    },\n    \"behavior_influences\": {\n      \"Confident\": {\n        \"risk_tolerance\": \"high\",\n        \"exploration_tendency\": \"high\",\n        \"planning_depth\": \"medium\"\n      }\n    }\n  }\n}\n</code></pre>\n<h3>Conversational AI Configuration</h3>\n<p>The conversational AI module manages platform integrations and communication settings:</p>\n<pre><code class=\"language-json\">{\n  \"discord_token\": \"\",\n  \"telegram_token\": \"\",\n  \"platforms\": {\n    \"discord\": {\n      \"enabled\": true,\n      \"command_prefix\": \"!\"\n    },\n    \"telegram\": {\n      \"enabled\": true,\n      \"command_prefix\": \"/\"\n    }\n  },\n  \"emotional_intelligence\": {\n    \"default_persona\": \"Balanced\",\n    \"mood_decay_rate\": 0.05,\n    \"context_window_hours\": 24\n  }\n}\n</code></pre>\n<h3>Persona Configuration</h3>\n<p>The <code>persona.json</code> file defines different personality types and their emotional response patterns:</p>\n<pre><code class=\"language-json\">{\n  \"personas\": {\n    \"Optimistic\": {\n      \"mood_multipliers\": {\n        \"Confident\": 1.5,\n        \"Curious\": 1.2,\n        \"Frustrated\": 0.5\n      },\n      \"description\": \"Sees the glass as half full. Bounces back from setbacks quickly.\",\n      \"adaptation_rate\": 0.1\n    },\n    \"Analytical\": {\n      \"mood_multipliers\": {\n        \"Confident\": 1.1,\n        \"Curious\": 1.8,\n        \"Frustrated\": 0.8\n      },\n      \"description\": \"Driven by data and logic. Less prone to strong emotional swings.\",\n      \"adaptation_rate\": 0.15\n    }\n  },\n  \"default_persona\": \"Balanced\"\n}\n</code></pre>\n<p><strong>Section sources</strong></p>\n<ul>\n<li><a>emotional_intellegence/config.json</a></li>\n<li><a>conversational_ai/config.json</a></li>\n<li><a>persona.json</a></li>\n</ul>\n<h2>Configuration Loading and Validation</h2>\n<p>The configuration system follows a well-defined process for loading and validating settings from multiple sources. The <code>Config</code> class automatically loads settings in the following priority order:</p>\n<ol>\n<li>Environment variables (highest priority)</li>\n<li>JSON configuration files</li>\n<li>Hard-coded default values</li>\n</ol>\n<h3>Configuration Validation</h3>\n<p>The system includes built-in validation for critical configuration parameters. For example, the Snake Agent configuration validates model settings and resource limits:</p>\n<pre><code class=\"language-python\">SNAKE_CODING_MODEL = {\n    \"provider\": \"ollama\",\n    \"model_name\": os.environ.get(\"SNAKE_CODING_MODEL\", \"gpt-oss:20b\"),\n    \"temperature\": float(os.environ.get(\"SNAKE_CODING_TEMPERATURE\", \"0.1\")),\n    \"max_tokens\": None if os.environ.get(\"SNAKE_CODING_MAX_TOKENS\", \"unlimited\").lower() in [\"unlimited\", \"none\", \"-1\"] else int(os.environ.get(\"SNAKE_CODING_MAX_TOKENS\", \"4096\")),\n    \"timeout\": int(os.environ.get(\"SNAKE_OLLAMA_TIMEOUT\", 3000))\n}\n</code></pre>\n<h3>Configuration Access Pattern</h3>\n<p>Components throughout the system access configuration values using direct attribute access:</p>\n<pre><code class=\"language-python\">from core.config import Config\n\n# Access configuration values\nif Config.BLOG_ENABLED:\n    publish_content()\n\nmodel_name = Config.SNAKE_CODING_MODEL[\"model_name\"]\ntimeout = Config.SNAKE_OLLAMA_TIMEOUT\n</code></pre>\n<p>This pattern is used consistently across 25+ files in the codebase, demonstrating the central role of the Config class in the system architecture.</p>\n<p>``mermaid\nflowchart TD\nA[Start] --> B[Load Environment Variables]\nB --> C{Variable Exists?}\nC --> |Yes| D[Use Environment Value]\nC --> |No| E[Use JSON File Value]\nE --> F{Value in JSON?}\nF --> |Yes| G[Use JSON Value]\nF --> |No| H[Use Default Value]\nD --> I[Convert to Proper Type]\nG --> I\nH --> I\nI --> J[Store in Config Class]\nJ --> K[Application Uses Config]</p>\n<pre><code>\n**Diagram sources**\n- [config.py](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\config.py#L2-L182)\n\n**Section sources**\n- [config.py](file://c:\\Users\\ASUS\\Documents\\GitHub\\RAVANA\\core\\config.py#L2-L182)\n\n## Environment Variables and Overrides\n\nThe system extensively uses environment variables to enable runtime configuration without modifying configuration files. This approach supports secure deployment practices by keeping sensitive information out of version control.\n\n### Override Mechanism\n\nThe override mechanism follows a simple pattern for all configuration values:\n\n```python\n# Pattern: os.environ.get(\"ENV_VAR_NAME\", \"default_value\")\nLOG_LEVEL = os.environ.get(\"LOG_LEVEL\", \"INFO\")\nCURIOSITY_CHANCE = float(os.environ.get(\"CURIOSITY_CHANCE\", 0.3))\nSNAKE_AGENT_ENABLED = bool(os.environ.get(\"SNAKE_AGENT_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])\n</code></pre>\n<h3>Common Environment Variables</h3>\n<p>The system recognizes numerous environment variables for different configuration aspects:</p>\n<p><strong>Autonomous Behavior</strong></p>\n<ul>\n<li><code>CURIOSITY_CHANCE</code>: Probability of initiating curiosity-driven actions (default: 0.3)</li>\n<li><code>REFLECTION_CHANCE</code>: Probability of self-reflection (default: 0.1)</li>\n<li><code>LOOP_SLEEP_DURATION</code>: Delay between autonomous loops (default: 10 seconds)</li>\n</ul>\n<p><strong>Snake Agent Configuration</strong></p>\n<ul>\n<li><code>SNAKE_AGENT_ENABLED</code>: Whether the Snake Agent is active (default: True)</li>\n<li><code>SNAKE_CODING_MODEL</code>: Ollama model for coding tasks (default: gpt-oss:20b)</li>\n<li><code>SNAKE_REASONING_MODEL</code>: Ollama model for reasoning tasks (default: deepseek-r1:7b)</li>\n</ul>\n<p><strong>Blog Integration</strong></p>\n<ul>\n<li><code>RAVANA_BLOG_ENABLED</code>: Whether blog publishing is enabled (default: True)</li>\n<li><code>RAVANA_BLOG_API_URL</code>: Endpoint for blog publishing (default: <a href=\"https://ravana-blog.netlify.app/api/publish\">https://ravana-blog.netlify.app/api/publish</a>)</li>\n<li><code>RAVANA_BLOG_AUTH_TOKEN</code>: Authentication token for blog API</li>\n</ul>\n<p><strong>Shutdown Configuration</strong></p>\n<ul>\n<li><code>GRACEFUL_SHUTDOWN_ENABLED</code>: Whether to perform graceful shutdown (default: True)</li>\n<li><code>SHUTDOWN_TIMEOUT</code>: Maximum time for shutdown process (default: 30 seconds)</li>\n<li><code>STATE_PERSISTENCE_ENABLED</code>: Whether to save state on shutdown (default: True)</li>\n<li><code>SHUTDOWN_HEALTH_CHECK_ENABLED</code>: Whether to perform health checks before shutdown (default: True)</li>\n<li><code>SHUTDOWN_BACKUP_ENABLED</code>: Whether to create backups during shutdown (default: True)</li>\n<li><code>SHUTDOWN_BACKUP_COUNT</code>: Number of backup files to retain (default: 5)</li>\n<li><code>SHUTDOWN_STATE_VALIDATION_ENABLED</code>: Whether to validate state data before persistence (default: True)</li>\n<li><code>SHUTDOWN_VALIDATION_ENABLED</code>: Whether to validate state file integrity (default: True)</li>\n<li><code>SHUTDOWN_COMPRESSION_ENABLED</code>: Whether to enable compression during shutdown (default: True)</li>\n<li><code>COMPONENT_PREPARE_TIMEOUT</code>: Timeout for component preparation phase (default: 10.0 seconds)</li>\n<li><code>COMPONENT_SHUTDOWN_TIMEOUT</code>: Timeout for component shutdown phase (default: 15.0 seconds)</li>\n<li><code>MEMORY_SERVICE_SHUTDOWN_TIMEOUT</code>: Timeout for memory service shutdown (default: 15 seconds)</li>\n<li><code>POSTGRES_CONNECTION_TIMEOUT</code>: Timeout for PostgreSQL connection (default: 10 seconds)</li>\n<li><code>CHROMADB_PERSIST_ON_SHUTDOWN</code>: Whether to persist ChromaDB data on shutdown (default: True)</li>\n<li><code>TEMP_FILE_CLEANUP_ENABLED</code>: Whether to clean up temporary files on shutdown (default: True)</li>\n<li><code>ACTION_CACHE_PERSIST</code>: Whether to persist action cache on shutdown (default: True)</li>\n<li><code>RESOURCE_CLEANUP_TIMEOUT</code>: Timeout for resource cleanup (default: 10 seconds)</li>\n<li><code>DATABASE_CLEANUP_TIMEOUT</code>: Timeout for database cleanup (default: 15 seconds)</li>\n<li><code>FORCE_SHUTDOWN_AFTER</code>: Maximum time before forcing shutdown (default: 60 seconds)</li>\n</ul>\n<p><strong>Section sources</strong></p>\n<ul>\n<li><a>config.py</a></li>\n</ul>\n<h2>Sensitive Data Handling</h2>\n<p>The system implements multiple strategies for handling sensitive configuration data securely.</p>\n<h3>API Key Management</h3>\n<p>API keys are stored in the <code>config.json</code> file alongside other provider configuration:</p>\n<pre><code class=\"language-json\">{\n  \"zuki\": {\n    \"api_key\": \"zu-ab9fba2aeef85c7ecb217b00ce7ca1fe\",\n    \"base_url\": \"https://api.zukijourney.com/v1\"\n  }\n}\n</code></pre>\n<p>For production deployments, these values should be overridden using environment variables to prevent accidental exposure in version control.</p>\n<h3>Token Security</h3>\n<p>Platform integration tokens are stored in module-specific configuration files:</p>\n<pre><code class=\"language-json\">{\n  \"discord_token\": \"\",\n  \"telegram_token\": \"\"\n}\n</code></pre>\n<p>These tokens should be managed using environment variables in production environments.</p>\n<h3>Secure Defaults</h3>\n<p>The system implements secure defaults for sensitive settings:</p>\n<pre><code class=\"language-python\"># Blog authentication token (should be overridden in production)\nBLOG_AUTH_TOKEN = os.environ.get(\"RAVANA_BLOG_AUTH_TOKEN\", \"ravana_secret_token_2024\")\n\n# Snake Agent safety configuration\nSNAKE_APPROVAL_REQUIRED = bool(os.environ.get(\"SNAKE_APPROVAL_REQUIRED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])\n</code></pre>\n<p>The default authentication token is intentionally weak to encourage users to set their own secure values.</p>\n<p><strong>Section sources</strong></p>\n<ul>\n<li><a>config.json</a></li>\n<li><a>conversational_ai/config.json</a></li>\n<li><a>config.py</a></li>\n</ul>\n<h2>Advanced Configuration Management</h2>\n<p>The system includes advanced configuration management capabilities through the VLTM (Very Long-Term Memory) configuration system and enhanced shutdown coordinator.</p>\n<h3>Enhanced Shutdown Configuration</h3>\n<p>The system now features a comprehensive shutdown configuration system with multiple phases and validation steps. The <code>shutdown_coordinator.py</code> file implements a multi-phase shutdown process:</p>\n<pre><code class=\"language-python\">class ShutdownCoordinator:\n    async def initiate_shutdown(self, reason: str = \"manual\"):\n        \"\"\"Initiate the graceful shutdown process.\"\"\"\n        # Execute shutdown phases in sequence\n        await self._execute_shutdown_phases()\n</code></pre>\n<h3>Shutdown Process Flow</h3>\n<p>The enhanced shutdown process follows a structured sequence of phases:</p>\n<p>``mermaid\ngraph TD\nA[Initiate Shutdown] --> B[Pre-Shutdown Validation]\nB --> C[Signal Received]\nC --> D[Component Notification]\nD --> E[Stop Background Tasks]\nE --> F[Resource Cleanup]\nF --> G[Service Shutdown]\nG --> H[State Persistence]\nH --> I[Final Validation]\nI --> J[Shutdown Complete]</p>\n<pre><code>\n### Shutdown Phase Configuration\n\nThe system supports configurable timeouts and behaviors for each shutdown phase:\n\n```python\n# Shutdown phase configuration\nSHUTDOWN_HEALTH_CHECK_ENABLED = bool(os.environ.get(\"SHUTDOWN_HEALTH_CHECK_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])\nSHUTDOWN_BACKUP_ENABLED = bool(os.environ.get(\"SHUTDOWN_BACKUP_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])\nSHUTDOWN_BACKUP_COUNT = int(os.environ.get(\"SHUTDOWN_BACKUP_COUNT\", 5))\nSHUTDOWN_STATE_VALIDATION_ENABLED = bool(os.environ.get(\"SHUTDOWN_STATE_VALIDATION_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])\nSHUTDOWN_VALIDATION_ENABLED = bool(os.environ.get(\"SHUTDOWN_VALIDATION_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])\nSHUTDOWN_COMPRESSION_ENABLED = bool(os.environ.get(\"SHUTDOWN_COMPRESSION_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])\nCOMPONENT_PREPARE_TIMEOUT = float(os.environ.get(\"COMPONENT_PREPARE_TIMEOUT\", 10.0))\nCOMPONENT_SHUTDOWN_TIMEOUT = float(os.environ.get(\"COMPONENT_SHUTDOWN_TIMEOUT\", 15.0))\n</code></pre>\n<h3>Shutdown Lifecycle</h3>\n<p>The system manages the full lifecycle of shutdown operations:</p>\n<p>``mermaid\nstateDiagram-v2\n[<em>] --> PreShutdownValidation\nPreShutdownValidation --> SignalReceived : health checks passed\nSignalReceived --> ComponentNotification : signal sent\nComponentNotification --> TasksStopping : components notified\nTasksStopping --> ResourceCleanup : tasks stopped\nResourceCleanup --> ServiceShutdown : resources cleaned\nServiceShutdown --> StatePersistence : services shutdown\nStatePersistence --> FinalValidation : state persisted\nFinalValidation --> ShutdownComplete : validation passed\nShutdownComplete --> [</em>]</p>\n<pre><code>\n### Shutdown History and Logging\n\nThe system maintains detailed logs of shutdown operations:\n\n```python\ndef _log_shutdown_summary(self):\n    \"\"\"Log a summary of the shutdown process.\"\"\"\n    log_data = {\n        \"shutdown_summary\": self.shutdown_state,\n        \"duration_seconds\": elapsed,\n        \"timestamp\": datetime.utcnow().isoformat()\n    }\n</code></pre>\n<p>This feature enables auditing and troubleshooting of shutdown operations.</p>\n<p><strong>Diagram sources</strong></p>\n<ul>\n<li><a>shutdown_coordinator.py</a></li>\n</ul>\n<p><strong>Section sources</strong></p>\n<ul>\n<li><a>shutdown_coordinator.py</a></li>\n<li><a>config.py</a></li>\n</ul>\n<h2>Configuration Examples</h2>\n<h3>Minimal Configuration</h3>\n<p>A minimal configuration file for local development:</p>\n<pre><code class=\"language-json\">{\n  \"zuki\": {\n    \"api_key\": \"your_zuki_api_key\",\n    \"base_url\": \"https://api.zukijourney.com/v1\",\n    \"models\": [\"gpt-4o\"]\n  },\n  \"local_situation_generator\": {\n    \"enabled\": true,\n    \"schedule\": \"daily\"\n  },\n  \"main_llm_decision_maker\": {\n    \"enabled\": true,\n    \"preferred_model\": \"gpt-4o\"\n  }\n}\n</code></pre>\n<h3>Production Environment Variables</h3>\n<p>Recommended environment variables for production deployment:</p>\n<pre><code class=\"language-bash\"># Database Configuration\nDATABASE_URL=postgresql://user:password@localhost/ravana_production\n\n# Logging\nLOG_LEVEL=WARNING\n\n# Autonomous Behavior\nCURIOSITY_CHANCE=0.1\nREFLECTION_CHANCE=0.05\nLOOP_SLEEP_DURATION=30\n\n# Snake Agent\nSNAKE_AGENT_ENABLED=true\nSNAKE_CODING_MODEL=deepseek-coder:6.7b\nSNAKE_REASONING_MODEL=llama3.1:8b\n\n# Blog Integration\nRAVANA_BLOG_ENABLED=true\nRAVANA_BLOG_API_URL=https://your-blog-api.com/publish\nRAVANA_BLOG_AUTH_TOKEN=your_secure_token_here\n\n# Shutdown Configuration\nGRACEFUL_SHUTDOWN_ENABLED=true\nSHUTDOWN_TIMEOUT=60\nSTATE_PERSISTENCE_ENABLED=true\nSHUTDOWN_HEALTH_CHECK_ENABLED=true\nSHUTDOWN_BACKUP_ENABLED=true\nSHUTDOWN_BACKUP_COUNT=10\nFORCE_SHUTDOWN_AFTER=120\n</code></pre>\n<h3>Development Override</h3>\n<p>Development-specific overrides to enable debugging:</p>\n<pre><code class=\"language-bash\"># Enable verbose logging\nLOG_LEVEL=DEBUG\nLOG_FORMAT=JSON\n\n# Faster loops for testing\nCURIOSITY_CHANCE=0.8\nREFLECTION_CHANCE=0.5\nLOOP_SLEEP_DURATION=2\n\n# Disable resource-intensive features\nSNAKE_AGENT_ENABLED=false\nBLOG_ENABLED=false\n\n# Shorter intervals for testing\nDATA_COLLECTION_INTERVAL=300\nEVENT_DETECTION_INTERVAL=60\n\n# Enhanced shutdown for testing\nSHUTDOWN_HEALTH_CHECK_ENABLED=false\nSHUTDOWN_BACKUP_ENABLED=false\nSHUTDOWN_STATE_VALIDATION_ENABLED=false\n</code></pre>\n<p><strong>Section sources</strong></p>\n<ul>\n<li><a>config.json</a></li>\n<li><a>config.py</a></li>\n</ul>\n<h2>Common Configuration Issues</h2>\n<h3>Missing Settings</h3>\n<p>When required settings are missing, the system uses default values which may not be appropriate for all environments:</p>\n<pre><code class=\"language-python\"># Problem: Using default SQLite database in production\nDATABASE_URL = os.environ.get(\"DATABASE_URL\", \"sqlite:///ravana_agi.db\")\n</code></pre>\n<p><strong>Solution</strong>: Always set <code>DATABASE_URL</code> in production to use a proper database:</p>\n<pre><code class=\"language-bash\">DATABASE_URL=postgresql://user:password@host:port/database_name\n</code></pre>\n<h3>Type Mismatches</h3>\n<p>Environment variables are strings, so type conversion errors can occur:</p>\n<pre><code class=\"language-python\"># Problem: String \"true\" doesn't convert to boolean correctly\nSNAKE_AGENT_ENABLED = os.environ.get(\"SNAKE_AGENT_ENABLED\", \"True\")\n</code></pre>\n<p><strong>Solution</strong>: Use proper boolean parsing:</p>\n<pre><code class=\"language-python\">SNAKE_AGENT_ENABLED = bool(os.environ.get(\"SNAKE_AGENT_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])\n</code></pre>\n<h3>API Key Rate Limiting</h3>\n<p>Multiple API keys help mitigate rate limiting, but improper configuration can still cause issues:</p>\n<pre><code class=\"language-json\">\"gemini\": {\n  \"api_keys\": [\n    {\n      \"id\": \"gemini_key_1\",\n      \"key\": \"your_actual_key_here\",  // Don't use placeholder keys\n      \"priority\": 1\n    }\n  ],\n  \"rate_limit\": {\n    \"requests_per_minute\": 60  // Ensure this matches provider limits\n  }\n}\n</code></pre>\n<h3>Configuration Reload Behavior</h3>\n<p>The current configuration system loads settings at startup and does not automatically reload when files change. For dynamic configuration updates, use environment variables or the VLTM configuration system.</p>\n<h3>Shutdown Configuration Issues</h3>\n<p>The enhanced shutdown system may encounter issues if not properly configured:</p>\n<pre><code class=\"language-python\"># Problem: Insufficient timeout for component preparation\nCOMPONENT_PREPARE_TIMEOUT = 1.0  # Too short for complex components\n\n# Problem: Disabled state validation in production\nSHUTDOWN_STATE_VALIDATION_ENABLED = false  # Risk of corrupted state files\n</code></pre>\n<p><strong>Solution</strong>: Use appropriate timeouts and enable validation in production:</p>\n<pre><code class=\"language-bash\">COMPONENT_PREPARE_TIMEOUT=30.0\nSHUTDOWN_STATE_VALIDATION_ENABLED=true\nSHUTDOWN_VALIDATION_ENABLED=true\n</code></pre>\n<p><strong>Section sources</strong></p>\n<ul>\n<li><a>config.py</a></li>\n<li><a>config.json</a></li>\n<li><a>shutdown_coordinator.py</a></li>\n</ul>\n<h2>Best Practices</h2>\n<h3>Environment-Specific Configurations</h3>\n<p>Use different configuration strategies for different environments:</p>\n<p><strong>Development</strong></p>\n<ul>\n<li>Use environment variables in <code>.env</code> files</li>\n<li>Enable verbose logging</li>\n<li>Use faster loop intervals for testing</li>\n<li>Disable resource-intensive features</li>\n<li>Disable shutdown health checks and backups</li>\n</ul>\n<p><strong>Production</strong></p>\n<ul>\n<li>Use environment variables from secure storage</li>\n<li>Set appropriate resource limits</li>\n<li>Use production-grade databases</li>\n<li>Implement proper error handling and monitoring</li>\n<li>Enable all shutdown validation and backup features</li>\n<li>Use multiple API keys with proper priorities</li>\n</ul>\n<h3>Secrets Management</h3>\n<p>Follow these guidelines for managing sensitive data:</p>\n<ol>\n<li>Never commit API keys or tokens to version control</li>\n<li>Use environment variables for sensitive settings</li>\n<li>Use different keys for development and production</li>\n<li>Rotate keys periodically</li>\n<li>Restrict key permissions to minimum required</li>\n<li>Use secure storage solutions for production secrets</li>\n</ol>\n<h3>Configuration Validation</h3>\n<p>Always validate configuration settings before use:</p>\n<pre><code class=\"language-python\">def validate_configuration():\n    \"\"\"Validate critical configuration settings\"\"\"\n    errors = []\n    \n    # Validate database URL\n    if \"sqlite\" in Config.DATABASE_URL and not Config.DATABASE_URL.startswith(\"sqlite\"):\n        errors.append(\"Invalid SQLite database URL format\")\n    \n    # Validate model names\n    valid_models = [\"gpt-4o\", \"deepseek-coder\", \"llama3.1\"]\n    if Config.SNAKE_CODING_MODEL[\"model_name\"] not in valid_models:\n        errors.append(f\"Invalid coding model: {Config.SNAKE_CODING_MODEL['model_name']}\")\n    \n    # Validate shutdown timeouts\n    if Config.FORCE_SHUTDOWN_AFTER &#x3C; Config.SHUTDOWN_TIMEOUT:\n        errors.append(\"FORCE_SHUTDOWN_AFTER must be greater than SHUTDOWN_TIMEOUT\")\n    \n    return errors\n</code></pre>\n<h3>Documentation and Comments</h3>\n<p>Maintain clear documentation for all configuration options:</p>\n<pre><code class=\"language-python\"># Autonomous Loop Settings\n# Controls the frequency and probability of autonomous behaviors\nCURIOSITY_CHANCE = float(os.environ.get(\"CURIOSITY_CHANCE\", 0.3))  # Probability of curiosity-driven actions\nREFLECTION_CHANCE = float(os.environ.get(\"REFLECTION_CHANCE\", 0.1))  # Probability of self-reflection\nLOOP_SLEEP_DURATION = int(os.environ.get(\"LOOP_SLEEP_DURATION\", 10))  # Seconds between loops\n\n# Enhanced Shutdown Configuration\n# Controls the graceful shutdown process with multiple phases and validation\nSHUTDOWN_HEALTH_CHECK_ENABLED = bool(os.environ.get(\"SHUTDOWN_HEALTH_CHECK_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])  # Enable pre-shutdown health checks\nSHUTDOWN_BACKUP_ENABLED = bool(os.environ.get(\"SHUTDOWN_BACKUP_ENABLED\", \"True\").lower() in [\"true\", \"1\", \"yes\"])  # Create backups during shutdown\nSHUTDOWN_BACKUP_COUNT = int(os.environ.get(\"SHUTDOWN_BACKUP_COUNT\", 5))  # Number of backup files to retain\n</code></pre>\n<p><strong>Section sources</strong></p>\n<ul>\n<li><a>config.py</a></li>\n</ul>\n<p><strong>Referenced Files in This Document</strong></p>\n<ul>\n<li><a>config.json</a> - <em>Updated with new Gemini API keys in commit 281c68a3</em></li>\n<li><a>config.py</a> - <em>Enhanced with new shutdown settings in commit 5d169a6a</em></li>\n<li><a>shutdown_coordinator.py</a> - <em>Added enhanced shutdown functionality</em></li>\n<li><a>llm.py</a> - <em>Gemini key management implementation</em></li>\n<li><a>pyproject.toml</a> - <em>Updated with new dependencies</em></li>\n</ul>\n"},"docs":[{"slug":"Action System","title":"Action System"},{"slug":"API Reference","title":"API Reference"},{"slug":"Architecture & Design","title":"Architecture & Design"},{"slug":"Configuration","title":"Configuration"},{"slug":"Conversational AI Communication Framework","title":"Conversational AI Communication Framework"},{"slug":"Core System","title":"Core System"},{"slug":"Database Schema","title":"Database Schema"},{"slug":"Decision-Making System","title":"Decision-Making System"},{"slug":"Deployment & Operations","title":"Deployment & Operations"},{"slug":"Development Guide","title":"Development Guide"},{"slug":"Emotional Intelligence","title":"Emotional Intelligence"},{"slug":"Enhanced Snake Agent","title":"Enhanced Snake Agent"},{"slug":"Enhanced Snake Agent Architecture","title":"Enhanced Snake Agent Architecture"},{"slug":"Graceful Shutdown","title":"Graceful Shutdown"},{"slug":"LLM Integration","title":"LLM Integration"},{"slug":"Memory Systems","title":"Memory Systems"},{"slug":"Multi-Modal Memory","title":"Multi-Modal Memory"},{"slug":"Project Overview","title":"Project Overview"},{"slug":"Self-Improvement","title":"Self-Improvement"},{"slug":"Services","title":"Services"},{"slug":"Snake Agent Configuration","title":"Snake Agent Configuration"},{"slug":"Specialized Modules-57f9b30b-b165-48d3-8e89-196940d26190","title":"Specialized Modules"},{"slug":"Specialized Modules","title":"Specialized Modules"}]},"__N_SSG":true}